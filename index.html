<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Payasita Run â€” RSTV</title>
<style>
  :root{
    --bg:#070707;
    --gold:#d4af37;
    --gold-dark:#b8860b;
    --panel:rgba(0,0,0,0.85);
  }
  *{margin:0;padding:0;box-sizing:border-box;}
  body{background:linear-gradient(180deg,#050505,#0a0a0a); font-family:sans-serif; display:flex; justify-content:center; align-items:center; min-height:100vh; overflow:hidden; color:#fff;}
  
  #gameContainer{
    position:relative; width:100%; max-width:900px; height:500px; background:var(--panel); border-radius:12px; overflow:hidden; border:2px solid var(--gold); box-shadow:0 8px 30px rgba(0,0,0,0.6);
  }

  canvas{display:block; width:100%; height:100%;}

  .controls{
    position:absolute; bottom:12px; left:50%; transform:translateX(-50%); display:flex; gap:12px;
  }
  .btn{
    padding:10px 14px; border-radius:10px; border:none; font-weight:700; cursor:pointer; background:#000; color:var(--gold);
  }
  .btn:active{transform:translateY(2px);}
</style>
</head>
<body>

<div id="gameContainer">
  <canvas id="gameCanvas"></canvas>
  <div class="controls">
    <button id="startBtn" class="btn">Comenzar</button>
    <button id="musicBtn" class="btn">ðŸŽµ MÃºsica</button>
  </div>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
let width = canvas.width = canvas.offsetWidth;
let height = canvas.height = canvas.offsetHeight;

// game state
let gameRunning = false;
let obstacles = [];
let items = [];
let score = 0;
let speed = 4;
let gravity = 0.6;
let jumpForce = -12;

// payasita sprite
const sprite = new Image();
sprite.src = 'https://i.ibb.co/0yZ0bQw/payasita-sprite.png'; // placeholder sprite URL, reemplaza por tu sprite
let spriteFrame = 0;
const spriteFrameCount = 4;
let spriteX = 80;
let spriteY = height - 120;
let spriteVY = 0;
let spriteWidth = 64;
let spriteHeight = 64;

// keys
const keys = {ArrowUp:false, ArrowDown:false};

// particles
let particles = [];

// music
let audioCtx = null;
let musicPlaying = false;
const musicBtn = document.getElementById('musicBtn');

musicBtn.addEventListener('click', ()=>{
    if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    musicPlaying = !musicPlaying;
    musicBtn.textContent = musicPlaying?'ðŸ”‡ MÃºsica':'ðŸŽµ MÃºsica';
});

// controls
document.addEventListener('keydown', e=>{ if(keys.hasOwnProperty(e.key)) keys[e.key]=true; });
document.addEventListener('keyup', e=>{ if(keys.hasOwnProperty(e.key)) keys[e.key]=false; });

// touch controls
canvas.addEventListener('touchstart', e=>{
    let t = e.touches[0];
    if(t.clientY < height/2) keys.ArrowUp=true;
    else keys.ArrowDown=true;
});
canvas.addEventListener('touchend', e=>{ keys.ArrowUp=false; keys.ArrowDown=false; });

// start button
document.getElementById('startBtn').addEventListener('click', ()=>{startGame();});

// resize
window.addEventListener('resize', ()=>{
    width = canvas.width = canvas.offsetWidth;
    height = canvas.height = canvas.offsetHeight;
});

// obstacle constructor
function Obstacle(x, y, w, h){
    this.x = x;
    this.y = y;
    this.w = w;
    this.h = h;
}
function Item(x, y, size){this.x=x; this.y=y; this.size=size;}

// game loop
function startGame(){
    gameRunning = true;
    score=0; obstacles=[]; items=[];
    spriteY = height - 120; spriteVY=0;
    speed=4;
    requestAnimationFrame(gameLoop);
}

function spawnObstacle(){
    let h = Math.random()*40 + 40;
    let y = height - h - 20;
    obstacles.push(new Obstacle(width, y, 30, h));
}
function spawnItem(){
    let size = 20;
    let y = Math.random()*(height-150)+50;
    items.push(new Item(width, y, size));
}

let frameCount=0;

function gameLoop(){
    if(!gameRunning) return;
    ctx.clearRect(0,0,width,height);

    // move sprite
    if(keys.ArrowUp && spriteY>=0) spriteVY=jumpForce;
    spriteVY += gravity;
    spriteY += spriteVY;
    if(spriteY > height-64-20) {spriteY = height-64-20; spriteVY=0;}

    // draw sprite frame
    spriteFrame +=0.15;
    if(spriteFrame>=spriteFrameCount) spriteFrame=0;
    ctx.drawImage(sprite, Math.floor(spriteFrame)*spriteWidth,0,spriteWidth,spriteHeight, spriteX, spriteY,64,64);

    // spawn obstacles & items
    if(frameCount%120===0) spawnObstacle();
    if(frameCount%180===0) spawnItem();

    // move and draw obstacles
    for(let i=obstacles.length-1;i>=0;i--){
        obstacles[i].x -= speed;
        ctx.fillStyle='red';
        ctx.fillRect(obstacles[i].x, obstacles[i].y, obstacles[i].w, obstacles[i].h);

        // collision
        if(spriteX<obstacles[i].x+obstacles[i].w && spriteX+64>obstacles[i].x && spriteY<obstacles[i].y+obstacles[i].h && spriteY+64>obstacles[i].y){
            gameRunning=false; alert('Â¡Perdiste! Puntaje: '+score);
        }
        if(obstacles[i].x+obstacles[i].w<0) obstacles.splice(i,1);
    }

    // move and draw items
    for(let i=items.length-1;i>=0;i--){
        items[i].x -= speed;
        ctx.fillStyle='gold';
        ctx.beginPath();
        ctx.arc(items[i].x+items[i].size/2, items[i].y+items[i].size/2, items[i].size/2,0,2*Math.PI);
        ctx.fill();

        // collect
        if(spriteX<items[i].x+items[i].size && spriteX+64>items[i].x && spriteY<items[i].y+items[i].size && spriteY+64>items[i].y){
            score++;
            spawnParticles(items[i].x+items[i].size/2, items[i].y+items[i].size/2);
            items.splice(i,1);
        }
        if(items[i] && items[i].x+items[i].size<0) items.splice(i,1);
    }

    // draw particles
    for(let i=particles.length-1;i>=0;i--){
        let p = particles[i];
        p.vy += 0.2;
        p.x += p.vx;
        p.y += p.vy;
        p.alpha -=0.03;
        ctx.fillStyle = `rgba(212,175,55,${p.alpha})`;
        ctx.beginPath();
        ctx.arc(p.x,p.y,p.size,0,2*Math.PI);
        ctx.fill();
        if(p.alpha<=0) particles.splice(i,1);
    }

    // score
    ctx.fillStyle='#fff'; ctx.font='20px sans-serif'; ctx.fillText('Puntaje: '+score, 12,30);

    frameCount++;
    requestAnimationFrame(gameLoop);
}

function spawnParticles(x,y){
    for(let i=0;i<15;i++){
        particles.push({
            x:x, y:y,
            vx:(Math.random()-0.5)*6,
            vy:(Math.random()-1.5)*-6,
            size: Math.random()*6+2,
            alpha:1
        });
    }
}
</script>
</body>
</html>